# Make ML Predictions Tool

This tool is designed to make predictions using a custom model deployed in DataRobot.  

For implementation details, please refer to the [custom_model](./custom_model) directory and the `custom.py` file.


## How to call the tool
To call or invoke the tool, send a properly formatted JSON request to the deployed modelâ€™s prediction endpoint in DataRobot using its API; the model processes your input and returns a prediction or summary. This can be done programmatically via scripts, command-line tools like `curl`, or integrated into applications.

Please refer to the [making predictions](../README.md#making-predictions) section of documentation for global tools for more technical details on how to call the tool.

### Input structure
When invoking the tool, provide a JSON request as input. The JSON request must include a top-level `payload` object. All parameters listed below should be placed inside this payload object, which will be forwarded to the tool.

**Payload parameters**:
- `deployment_id` (string): The DataRobot deployment ID to request predictions from.
- `columns_to_return_with_predictions` (array of strings, required): A list of columns from the input data to merge back onto the output data for reference.
- `input_data_json_str` (string): A JSON-formatted array of rows to use for generating predictions.
- `input_dataframe` (string): A CSV-formatted string or a DataFrame cache ID to use for predictions.

Example:

```json
{
    "payload": {
        "deployment_id": "685015663f9a49e9ad9c62e2", 
        "columns_to_return_with_predictions": [
            "discharge_disposition_id", 
            "num_lab_procedures", 
            "num_procedures", 
            "num_medications"
        ], 
        "input_dataframe": "race,gender,age,weight,admission_type_id,discharge_disposition_id,admission_source_id,time_in_hospital,payer_code,medical_specialty,num_lab_procedures,num_procedures,num_medications,number_outpatient,number_emergency,number_inpatient,diag_1,diag_2,diag_3,number_diagnoses,max_glu_serum,A1Cresult,metformin,repaglinide,nateglinide,chlorpropamide,glimepiride,acetohexamide,glipizide,glyburide,tolbutamide,pioglitazone,rosiglitazone,acarbose,miglitol,troglitazone,tolazamide,examide,citoglipton,insulin,glyburide_metformin,glipizide_metformin,glimepiride_pioglitazone,metformin_rosiglitazone,metformin_pioglitazone,change,diabetesMed,readmitted,diag_1_desc,diag_2_desc,diag_3_desc\nCaucasian,Female,[50-60),?,Elective,Discharged to home,Physician Referral,1,CP,Surgery-Neuro,35,4,21,0,0,0,723,723,719,9,,,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,False,Spinal stenosis in cervical region,Spinal stenosis in cervical region,\"Effusion of joint, site unspecified\"\nCaucasian,Female,[20-30),[50-75),Urgent,Discharged to home,Physician Referral,2,UN,?,8,5,5,0,0,0,664,648,285,6,,,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,False,\"First-degree perineal laceration, unspecified as to episode of care or not applicable\",\"Diabetes mellitus of mother, complicating pregnancy, childbirth, or the puerperium, unspecified as to episode of care or not applicable\",Sideroblastic anemia\nCaucasian,Male,[80-90),?,Not Available,Discharged/transferred to home with home health service,,7,MC,Family/GeneralPractice,12,0,21,0,0,1,481,428,276,9,>200,,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,No,Steady,No,No,No,No,No,No,Yes,True,Pneumococcal pneumonia [Streptococcus pneumoniae pneumonia],\"Congestive heart failure, unspecified\",Hyperosmolality and/or hypernatremia\n"
    }
}
```

### Output structure
The output has the MIME type `text/csv` with `utf-8` encoding and contains the dataframe with predictions. The output will include the columns specified in `columns_to_return_with_predictions` along with the predictions generated by the model. 

```
discharge_disposition_id,num_lab_procedures,num_procedures,num_medications,prediction
Discharged to home,35,4,21,0
Discharged to home,8,5,5,1
Discharged/transferred to home with home health service,12,0,21,0
```